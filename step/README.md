# Profiling Agent Steps

This directory (`step/`) contains individual agents or "steps" that form parts of a larger automated C++ performance analysis and code optimization pipeline.

Each subdirectory typically represents a distinct agent with its own specific role, configuration, and an associated LLM prompt to guide its behavior.

## Available Agents

Currently, the following agents are implemented:

### 1. Analyzer Agent (`step/analyzer/`)

-   **Purpose:** To analyze C++ performance data, typically from Linux `perf` output, in conjunction with the source code.
-   **Functionality:** It uses an LLM to identify performance bottlenecks, determine their likely causes, and extract key information like bottleneck location, type, and a detailed hypothesis.
-   **Output:** Produces a YAML file containing the full analysis from the LLM, along with parsed, structured fields (`bottleneck_location`, `bottleneck_type`, `analysis_hypothesis`) for easy consumption by subsequent agents.
-   **Details:** For more information on its specific inputs, outputs, and how to run it, please see `step/analyzer/README.md`.

### 2. Replicator Agent (`step/replicator/`)

-   **Purpose:** To take the analyzed performance bottleneck information and propose potential code modifications to address it.
-   **Functionality:** It uses an LLM to understand the provided bottleneck details (location, type, hypothesis) and the original source code. It then generates a proposed fix strategy and multiple distinct C++ code variants that attempt to implement a solution.
-   **Output:** Produces a YAML file containing the proposed fix strategy and a list of modified code variants, each with an explanation and the C++ code.
-   **Details:** For more information on its specific inputs, outputs, and how to run it, please see `step/replicator/README.md`.

## Pipeline Workflow Example

These agents are designed to work in a sequence. A common workflow would be:

1.  **Run the Analyzer Agent:** Provide it with C++ source code and `perf` profiling data. It outputs an analysis YAML (`analyzer_output.yaml`).
    ```bash
    poetry run python -m step.analyzer.analyzer_agent -o step/analyzer/examples/analyzer_output.yaml step/analyzer/examples/analyzer_input_example.yaml
    ```
2.  **Run the Replicator Agent:** Use the output from the Analyzer (`analyzer_output.yaml`) as the input for the Replicator. It will then generate potential code fixes based on the analysis.
    ```bash
    poetry run python -m step.replicator.replicator_agent -o step/replicator/examples/replicator_output.yaml step/analyzer/examples/analyzer_output.yaml
    ```

This pipeline allows for an automated flow from performance data collection and analysis to the generation of potential code optimizations.

## Further Steps (Conceptual)

Future agents in this directory could extend the pipeline, for example:

-   An **Evaluator Agent:** To compile and test the code variants generated by the Replicator, possibly using benchmarks or formal verification tools.
-   An **Integrator Agent:** To attempt to integrate successfully evaluated code changes back into the original codebase (e.g., by generating diffs or patches).
